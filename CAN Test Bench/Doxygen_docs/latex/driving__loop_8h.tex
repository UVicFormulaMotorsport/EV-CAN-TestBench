\hypertarget{driving__loop_8h}{}\doxysection{Core/\+Inc/driving\+\_\+loop.h File Reference}
\label{driving__loop_8h}\index{Core/Inc/driving\_loop.h@{Core/Inc/driving\_loop.h}}
{\ttfamily \#include \char`\"{}motor\+\_\+controller.\+h\char`\"{}}\newline
\doxysubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structdriving_mode_params}{driving\+Mode\+Params}}
\begin{DoxyCompactList}\small\item\em this struct is designed to hold information about each drivingmode\textquotesingle{}s map params \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structdriving_mode}{driving\+Mode}}
\item 
struct \mbox{\hyperlink{structdriving_loop_args}{driving\+Loop\+Args}}
\begin{DoxyCompactList}\small\item\em Arguments for the driving loop. The reason this is a struct passed in as an argument, rather than a bunch of global variables or constants is to allow the code to take settings from flash memory, therefore allowing the team to meet it\textquotesingle{}s goal of having an actual G\+UI to change vehicle settings. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{driving__loop_8h_a19ae3417888a615aca7350e9e1ba0204}{D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+E\+R\+I\+OD}}~50
\begin{DoxyCompactList}\small\item\em D\+L\+\_\+\+P\+E\+R\+I\+OD is meant to represent how often the driving loop executes, in ms. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef uint16\+\_\+t \mbox{\hyperlink{driving__loop_8h_a5ec2330fa2301c68498a6ff0825998c9}{M\+C\+\_\+\+Torque}}
\item 
typedef uint16\+\_\+t \mbox{\hyperlink{driving__loop_8h_abd1701d9bbc137696fe99b6df6eb7d3e}{M\+C\+\_\+\+R\+PM}}
\item 
typedef uint16\+\_\+t \mbox{\hyperlink{driving__loop_8h_a93f3b2b453b1ad01d8555f12e529dfed}{M\+C\+\_\+\+P\+O\+W\+ER}}
\item 
typedef struct \mbox{\hyperlink{structdriving_mode_params}{driving\+Mode\+Params}} \mbox{\hyperlink{driving__loop_8h_ac1d30630084a642c9209dca3a961ef12}{driving\+Mode\+Params}}
\begin{DoxyCompactList}\small\item\em this struct is designed to hold information about each drivingmode\textquotesingle{}s map params \end{DoxyCompactList}\item 
typedef struct \mbox{\hyperlink{structdriving_mode}{driving\+Mode}} \mbox{\hyperlink{driving__loop_8h_a29e04283e579e9092d205b1937c785c6}{driving\+Mode}}
\item 
typedef struct \mbox{\hyperlink{structdriving_loop_args}{driving\+Loop\+Args}} \mbox{\hyperlink{driving__loop_8h_a3decdbe473e5d736311930ce3d6360bd}{driving\+Loop\+Args}}
\end{DoxyCompactItemize}
\doxysubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \mbox{\hyperlink{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800}{map\+\_\+mode}} \{ \newline
\mbox{\hyperlink{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a24491cb716ed427ea52ef6cdbf415b52}{linear\+\_\+speed\+\_\+map}}, 
\mbox{\hyperlink{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a20916d6e654ff6402aa120d8710a81a0}{s\+\_\+curve\+\_\+speed\+\_\+map}}, 
\mbox{\hyperlink{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a260f2e914699db0b53b3cb852559b40f}{exp\+\_\+speed\+\_\+map}}, 
\mbox{\hyperlink{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a02e428d0c5cf187b04a2e9825079d26a}{linear\+\_\+torque\+\_\+map}}, 
\newline
\mbox{\hyperlink{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a97cb36a9ac4fbbe2e7b481a2677993f9}{s\+\_\+curve\+\_\+torque\+\_\+map}}, 
\mbox{\hyperlink{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a22ffbb99cbb49917aac9c53aba81df32}{exp\+\_\+torque\+\_\+map}}
 \}
\item 
enum \mbox{\hyperlink{driving__loop_8h_adef4571b048b5b1f2b712713741296c7}{D\+L\+\_\+internal\+\_\+state}} \{ \mbox{\hyperlink{driving__loop_8h_adef4571b048b5b1f2b712713741296c7a51000915ad3f7b4a5874322723d879ca}{Plausible}} = 0x01, 
\mbox{\hyperlink{driving__loop_8h_adef4571b048b5b1f2b712713741296c7a6425b90f597e6400cfb9422ec518334f}{Implausible}} = 0x02, 
\mbox{\hyperlink{driving__loop_8h_adef4571b048b5b1f2b712713741296c7abb3086179f14a3715ce589bd10c3ec98}{Erroneous}} = 0x04
 \}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{driving__loop_8h_adb031c91acd0bc6d700819cde7ec58f2}{Start\+Driving\+Loop}} (void const $\ast$argument)
\begin{DoxyCompactList}\small\item\em Function implementing the led\+Task thread. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{driving__loop_8h_a19ae3417888a615aca7350e9e1ba0204}\label{driving__loop_8h_a19ae3417888a615aca7350e9e1ba0204}} 
\index{driving\_loop.h@{driving\_loop.h}!DEFAULT\_PERIOD@{DEFAULT\_PERIOD}}
\index{DEFAULT\_PERIOD@{DEFAULT\_PERIOD}!driving\_loop.h@{driving\_loop.h}}
\doxysubsubsection{\texorpdfstring{DEFAULT\_PERIOD}{DEFAULT\_PERIOD}}
{\footnotesize\ttfamily \#define D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+E\+R\+I\+OD~50}



D\+L\+\_\+\+P\+E\+R\+I\+OD is meant to represent how often the driving loop executes, in ms. 

@define D\+L\+\_\+\+P\+E\+R\+I\+OD This is a define since I would eventually like this to be configurable via a global variable, or possible be dynamic in the future.

Just replace the number with the name of the variable, and you\textquotesingle{}re all set. 

Definition at line 25 of file driving\+\_\+loop.\+h.



\doxysubsection{Typedef Documentation}
\mbox{\Hypertarget{driving__loop_8h_a3decdbe473e5d736311930ce3d6360bd}\label{driving__loop_8h_a3decdbe473e5d736311930ce3d6360bd}} 
\index{driving\_loop.h@{driving\_loop.h}!drivingLoopArgs@{drivingLoopArgs}}
\index{drivingLoopArgs@{drivingLoopArgs}!driving\_loop.h@{driving\_loop.h}}
\doxysubsubsection{\texorpdfstring{drivingLoopArgs}{drivingLoopArgs}}
{\footnotesize\ttfamily typedef struct \mbox{\hyperlink{structdriving_loop_args}{driving\+Loop\+Args}} \mbox{\hyperlink{structdriving_loop_args}{driving\+Loop\+Args}}}

\mbox{\Hypertarget{driving__loop_8h_a29e04283e579e9092d205b1937c785c6}\label{driving__loop_8h_a29e04283e579e9092d205b1937c785c6}} 
\index{driving\_loop.h@{driving\_loop.h}!drivingMode@{drivingMode}}
\index{drivingMode@{drivingMode}!driving\_loop.h@{driving\_loop.h}}
\doxysubsubsection{\texorpdfstring{drivingMode}{drivingMode}}
{\footnotesize\ttfamily typedef struct \mbox{\hyperlink{structdriving_mode}{driving\+Mode}} \mbox{\hyperlink{structdriving_mode}{driving\+Mode}}}

\mbox{\Hypertarget{driving__loop_8h_ac1d30630084a642c9209dca3a961ef12}\label{driving__loop_8h_ac1d30630084a642c9209dca3a961ef12}} 
\index{driving\_loop.h@{driving\_loop.h}!drivingModeParams@{drivingModeParams}}
\index{drivingModeParams@{drivingModeParams}!driving\_loop.h@{driving\_loop.h}}
\doxysubsubsection{\texorpdfstring{drivingModeParams}{drivingModeParams}}
{\footnotesize\ttfamily typedef struct \mbox{\hyperlink{structdriving_mode_params}{driving\+Mode\+Params}} \mbox{\hyperlink{structdriving_mode_params}{driving\+Mode\+Params}}}



this struct is designed to hold information about each drivingmode\textquotesingle{}s map params 

\mbox{\Hypertarget{driving__loop_8h_a93f3b2b453b1ad01d8555f12e529dfed}\label{driving__loop_8h_a93f3b2b453b1ad01d8555f12e529dfed}} 
\index{driving\_loop.h@{driving\_loop.h}!MC\_POWER@{MC\_POWER}}
\index{MC\_POWER@{MC\_POWER}!driving\_loop.h@{driving\_loop.h}}
\doxysubsubsection{\texorpdfstring{MC\_POWER}{MC\_POWER}}
{\footnotesize\ttfamily typedef uint16\+\_\+t \mbox{\hyperlink{driving__loop_8h_a93f3b2b453b1ad01d8555f12e529dfed}{M\+C\+\_\+\+P\+O\+W\+ER}}}



Definition at line 15 of file driving\+\_\+loop.\+h.

\mbox{\Hypertarget{driving__loop_8h_abd1701d9bbc137696fe99b6df6eb7d3e}\label{driving__loop_8h_abd1701d9bbc137696fe99b6df6eb7d3e}} 
\index{driving\_loop.h@{driving\_loop.h}!MC\_RPM@{MC\_RPM}}
\index{MC\_RPM@{MC\_RPM}!driving\_loop.h@{driving\_loop.h}}
\doxysubsubsection{\texorpdfstring{MC\_RPM}{MC\_RPM}}
{\footnotesize\ttfamily typedef uint16\+\_\+t \mbox{\hyperlink{driving__loop_8h_abd1701d9bbc137696fe99b6df6eb7d3e}{M\+C\+\_\+\+R\+PM}}}



Definition at line 14 of file driving\+\_\+loop.\+h.

\mbox{\Hypertarget{driving__loop_8h_a5ec2330fa2301c68498a6ff0825998c9}\label{driving__loop_8h_a5ec2330fa2301c68498a6ff0825998c9}} 
\index{driving\_loop.h@{driving\_loop.h}!MC\_Torque@{MC\_Torque}}
\index{MC\_Torque@{MC\_Torque}!driving\_loop.h@{driving\_loop.h}}
\doxysubsubsection{\texorpdfstring{MC\_Torque}{MC\_Torque}}
{\footnotesize\ttfamily typedef uint16\+\_\+t \mbox{\hyperlink{driving__loop_8h_a5ec2330fa2301c68498a6ff0825998c9}{M\+C\+\_\+\+Torque}}}



Definition at line 13 of file driving\+\_\+loop.\+h.



\doxysubsection{Enumeration Type Documentation}
\mbox{\Hypertarget{driving__loop_8h_adef4571b048b5b1f2b712713741296c7}\label{driving__loop_8h_adef4571b048b5b1f2b712713741296c7}} 
\index{driving\_loop.h@{driving\_loop.h}!DL\_internal\_state@{DL\_internal\_state}}
\index{DL\_internal\_state@{DL\_internal\_state}!driving\_loop.h@{driving\_loop.h}}
\doxysubsubsection{\texorpdfstring{DL\_internal\_state}{DL\_internal\_state}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{driving__loop_8h_adef4571b048b5b1f2b712713741296c7}{D\+L\+\_\+internal\+\_\+state}}}

\begin{DoxyEnumFields}{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{Plausible@{Plausible}!driving\_loop.h@{driving\_loop.h}}\index{driving\_loop.h@{driving\_loop.h}!Plausible@{Plausible}}}\mbox{\Hypertarget{driving__loop_8h_adef4571b048b5b1f2b712713741296c7a51000915ad3f7b4a5874322723d879ca}\label{driving__loop_8h_adef4571b048b5b1f2b712713741296c7a51000915ad3f7b4a5874322723d879ca}} 
Plausible&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{Implausible@{Implausible}!driving\_loop.h@{driving\_loop.h}}\index{driving\_loop.h@{driving\_loop.h}!Implausible@{Implausible}}}\mbox{\Hypertarget{driving__loop_8h_adef4571b048b5b1f2b712713741296c7a6425b90f597e6400cfb9422ec518334f}\label{driving__loop_8h_adef4571b048b5b1f2b712713741296c7a6425b90f597e6400cfb9422ec518334f}} 
Implausible&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{Erroneous@{Erroneous}!driving\_loop.h@{driving\_loop.h}}\index{driving\_loop.h@{driving\_loop.h}!Erroneous@{Erroneous}}}\mbox{\Hypertarget{driving__loop_8h_adef4571b048b5b1f2b712713741296c7abb3086179f14a3715ce589bd10c3ec98}\label{driving__loop_8h_adef4571b048b5b1f2b712713741296c7abb3086179f14a3715ce589bd10c3ec98}} 
Erroneous&\\
\hline

\end{DoxyEnumFields}


Definition at line 40 of file driving\+\_\+loop.\+h.

\mbox{\Hypertarget{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800}\label{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800}} 
\index{driving\_loop.h@{driving\_loop.h}!map\_mode@{map\_mode}}
\index{map\_mode@{map\_mode}!driving\_loop.h@{driving\_loop.h}}
\doxysubsubsection{\texorpdfstring{map\_mode}{map\_mode}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800}{map\+\_\+mode}}}

This enum is meant to represent different functions that map the torque to speed. \begin{DoxyEnumFields}{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{linear\_speed\_map@{linear\_speed\_map}!driving\_loop.h@{driving\_loop.h}}\index{driving\_loop.h@{driving\_loop.h}!linear\_speed\_map@{linear\_speed\_map}}}\mbox{\Hypertarget{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a24491cb716ed427ea52ef6cdbf415b52}\label{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a24491cb716ed427ea52ef6cdbf415b52}} 
linear\+\_\+speed\+\_\+map&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{s\_curve\_speed\_map@{s\_curve\_speed\_map}!driving\_loop.h@{driving\_loop.h}}\index{driving\_loop.h@{driving\_loop.h}!s\_curve\_speed\_map@{s\_curve\_speed\_map}}}\mbox{\Hypertarget{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a20916d6e654ff6402aa120d8710a81a0}\label{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a20916d6e654ff6402aa120d8710a81a0}} 
s\+\_\+curve\+\_\+speed\+\_\+map&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{exp\_speed\_map@{exp\_speed\_map}!driving\_loop.h@{driving\_loop.h}}\index{driving\_loop.h@{driving\_loop.h}!exp\_speed\_map@{exp\_speed\_map}}}\mbox{\Hypertarget{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a260f2e914699db0b53b3cb852559b40f}\label{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a260f2e914699db0b53b3cb852559b40f}} 
exp\+\_\+speed\+\_\+map&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{linear\_torque\_map@{linear\_torque\_map}!driving\_loop.h@{driving\_loop.h}}\index{driving\_loop.h@{driving\_loop.h}!linear\_torque\_map@{linear\_torque\_map}}}\mbox{\Hypertarget{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a02e428d0c5cf187b04a2e9825079d26a}\label{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a02e428d0c5cf187b04a2e9825079d26a}} 
linear\+\_\+torque\+\_\+map&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{s\_curve\_torque\_map@{s\_curve\_torque\_map}!driving\_loop.h@{driving\_loop.h}}\index{driving\_loop.h@{driving\_loop.h}!s\_curve\_torque\_map@{s\_curve\_torque\_map}}}\mbox{\Hypertarget{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a97cb36a9ac4fbbe2e7b481a2677993f9}\label{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a97cb36a9ac4fbbe2e7b481a2677993f9}} 
s\+\_\+curve\+\_\+torque\+\_\+map&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{exp\_torque\_map@{exp\_torque\_map}!driving\_loop.h@{driving\_loop.h}}\index{driving\_loop.h@{driving\_loop.h}!exp\_torque\_map@{exp\_torque\_map}}}\mbox{\Hypertarget{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a22ffbb99cbb49917aac9c53aba81df32}\label{driving__loop_8h_a9d8fd287924cbb6baa4afd1c585da800a22ffbb99cbb49917aac9c53aba81df32}} 
exp\+\_\+torque\+\_\+map&\\
\hline

\end{DoxyEnumFields}


Definition at line 31 of file driving\+\_\+loop.\+h.



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{driving__loop_8h_adb031c91acd0bc6d700819cde7ec58f2}\label{driving__loop_8h_adb031c91acd0bc6d700819cde7ec58f2}} 
\index{driving\_loop.h@{driving\_loop.h}!StartDrivingLoop@{StartDrivingLoop}}
\index{StartDrivingLoop@{StartDrivingLoop}!driving\_loop.h@{driving\_loop.h}}
\doxysubsubsection{\texorpdfstring{StartDrivingLoop()}{StartDrivingLoop()}}
{\footnotesize\ttfamily void Start\+Driving\+Loop (\begin{DoxyParamCaption}\item[{void const $\ast$}]{argument }\end{DoxyParamCaption})}



Function implementing the led\+Task thread. 


\begin{DoxyParams}{Parameters}
{\em argument} & Not used for now. Will have configuration settings later. \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em None} & This function is made to be the meat and potatoes of the entire vehicle. \\
\hline
\end{DoxyRetVals}
The first thing we do here is create some local variables here, to cache whatever variables need cached. We will be caching variables that are used very frequently in every single loop iteration, and are not

@heading Brake Plausibility Check

The way that this works is that if the brake pressure is greater than some threshold, and the accelerator pedal position is also greater than some threshold, the thing will register that a brake implausibility has occurred. This is not very cash money.

If this happens, we want to set the torque/speed output to zero. This will only reset itself once the brakes are set to less than a certain threshold. Honestly evil.

Definition at line 34 of file driving\+\_\+loop.\+c.



References adc1\+\_\+\+A\+P\+P\+S1, adc1\+\_\+\+A\+P\+P\+S2, adc1\+\_\+\+B\+P\+S1, adc1\+\_\+\+B\+P\+S2, driving\+Loop\+Args\+::apps\+\_\+plausibility\+\_\+check\+\_\+threshold, driving\+Loop\+Args\+::bps\+\_\+plausibility\+\_\+check\+\_\+threshold, D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+E\+R\+I\+OD, Implausible, driving\+Loop\+Args\+::max\+\_\+apps\+\_\+offset, driving\+Loop\+Args\+::max\+\_\+apps\+\_\+value, driving\+Loop\+Args\+::max\+\_\+\+B\+P\+S\+\_\+value, driving\+Loop\+Args\+::min\+\_\+apps\+\_\+offset, driving\+Loop\+Args\+::min\+\_\+apps\+\_\+value, and Plausible.

