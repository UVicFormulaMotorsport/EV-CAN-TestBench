\hypertarget{uvfr__utils_8c}{}\doxysection{Core/\+Src/uvfr\+\_\+utils.c File Reference}
\label{uvfr__utils_8c}\index{Core/Src/uvfr\_utils.c@{Core/Src/uvfr\_utils.c}}
{\ttfamily \#include \char`\"{}uvfr\+\_\+utils.\+h\char`\"{}}\newline
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{uvfr__utils_8c_af0c3770bb8c05b338afd53946909189c}{U\+V\+\_\+\+U\+T\+I\+L\+S\+\_\+\+S\+R\+C\+\_\+\+I\+M\+P\+L\+I\+M\+E\+N\+T\+A\+T\+I\+ON}}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{uvfr__utils_8c_a6d40598f9d8daa89ca159a2e87f4fd01}{uv\+Init}} (void $\ast$arguments)
\begin{DoxyCompactList}\small\item\em \+: Function that initializes all of the car\textquotesingle{}s stuff. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{uvfr__utils_8c_a11806db468fdae50664b98e619575425}{uv\+Sys\+Reset\+Daemon}} (void $\ast$args)
\item 
enum \mbox{\hyperlink{uvfr__utils_8h_a71c52c44be11d0980910401cb9b5fb9e}{uv\+\_\+status\+\_\+t}} \mbox{\hyperlink{uvfr__utils_8c_a02781145b4802ebdc7001800bbe6d994}{uv\+Utils\+Reset}} ()
\begin{DoxyCompactList}\small\item\em This function is a soft-\/reboot of the uv\+\_\+utils\+\_\+backend and OS abstraction. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{uvfr__utils_8c_ab80c00a024c34da7f7926212ce10ef01}{setup\+\_\+extern\+\_\+devices}} (void $\ast$argument)
\item 
void \mbox{\hyperlink{uvfr__utils_8c_a92b5ac44171d49acd084c274385a043a}{\+\_\+\+\_\+uv\+Init\+Panic}} ()
\begin{DoxyCompactList}\small\item\em Low Level Panic, that does not require the full U\+V\+FR utils functionality to be operational. \end{DoxyCompactList}\item 
void $\ast$ \mbox{\hyperlink{uvfr__utils_8c_abc00b3cb1c3b54fe4490c08ef85a293a}{\+\_\+\+\_\+uv\+Malloc\+Crit\+Section}} (size\+\_\+t memrequest)
\begin{DoxyCompactList}\small\item\em Wrapper function for {\ttfamily malloc()} that makes it thread safe. \end{DoxyCompactList}\item 
\mbox{\hyperlink{can_8h_aef3770e45bbacbf527fd93dd80eea9b9}{uv\+\_\+status}} \mbox{\hyperlink{uvfr__utils_8c_ad372aabf81974eb44819f326172a563b}{\+\_\+\+\_\+uv\+Free\+Crit\+Section}} (void $\ast$ptr)
\begin{DoxyCompactList}\small\item\em Thread-\/safe wrapper for {\ttfamily free}. \end{DoxyCompactList}\item 
void $\ast$ \mbox{\hyperlink{uvfr__utils_8c_a498966c0f95bfa592d26b625a93fa1a3}{\+\_\+\+\_\+uv\+Malloc\+OS}} (size\+\_\+t memrequest)
\begin{DoxyCompactList}\small\item\em {\ttfamily malloc()} wrapper that calls pv\+Port\+Malloc() rather than malloc() \end{DoxyCompactList}\item 
\mbox{\hyperlink{can_8h_aef3770e45bbacbf527fd93dd80eea9b9}{uv\+\_\+status}} \mbox{\hyperlink{uvfr__utils_8c_a67fb0753300c33287657882ccff64e42}{\+\_\+\+\_\+uv\+Free\+OS}} (void $\ast$ptr)
\begin{DoxyCompactList}\small\item\em O\+S-\/based free wrapper that calls pv\+Port\+Free. \end{DoxyCompactList}\item 
\mbox{\hyperlink{can_8h_aef3770e45bbacbf527fd93dd80eea9b9}{uv\+\_\+status}} \mbox{\hyperlink{uvfr__utils_8c_a0186c036688c7852cf0ceaee96b343a3}{uv\+Is\+P\+T\+R\+Valid}} (void $\ast$ptr)
\begin{DoxyCompactList}\small\item\em function that checks to make sure a pointer points to a place it is allowed to point to \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
Task\+Handle\+\_\+t \mbox{\hyperlink{uvfr__utils_8c_a142da7a698285a444ffffb0d1d791023}{init\+\_\+task\+\_\+handle}}
\item 
uint8\+\_\+t \mbox{\hyperlink{uvfr__utils_8c_af553c31425b32bd9c020380c942ed3bd}{Tx\+Data}} \mbox{[}8\mbox{]}
\item 
Task\+Handle\+\_\+t \mbox{\hyperlink{uvfr__utils_8c_a4e2f70766df64229ab99dfe80c0c012a}{reset\+\_\+handle}} = N\+U\+LL
\end{DoxyCompactItemize}


\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{uvfr__utils_8c_af0c3770bb8c05b338afd53946909189c}\label{uvfr__utils_8c_af0c3770bb8c05b338afd53946909189c}} 
\index{uvfr\_utils.c@{uvfr\_utils.c}!UV\_UTILS\_SRC\_IMPLIMENTATION@{UV\_UTILS\_SRC\_IMPLIMENTATION}}
\index{UV\_UTILS\_SRC\_IMPLIMENTATION@{UV\_UTILS\_SRC\_IMPLIMENTATION}!uvfr\_utils.c@{uvfr\_utils.c}}
\doxysubsubsection{\texorpdfstring{UV\_UTILS\_SRC\_IMPLIMENTATION}{UV\_UTILS\_SRC\_IMPLIMENTATION}}
{\footnotesize\ttfamily \#define U\+V\+\_\+\+U\+T\+I\+L\+S\+\_\+\+S\+R\+C\+\_\+\+I\+M\+P\+L\+I\+M\+E\+N\+T\+A\+T\+I\+ON}



Definition at line 9 of file uvfr\+\_\+utils.\+c.



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{uvfr__utils_8c_ad372aabf81974eb44819f326172a563b}\label{uvfr__utils_8c_ad372aabf81974eb44819f326172a563b}} 
\index{uvfr\_utils.c@{uvfr\_utils.c}!\_\_uvFreeCritSection@{\_\_uvFreeCritSection}}
\index{\_\_uvFreeCritSection@{\_\_uvFreeCritSection}!uvfr\_utils.c@{uvfr\_utils.c}}
\doxysubsubsection{\texorpdfstring{\_\_uvFreeCritSection()}{\_\_uvFreeCritSection()}}
{\footnotesize\ttfamily \mbox{\hyperlink{can_8h_aef3770e45bbacbf527fd93dd80eea9b9}{uv\+\_\+status}} \+\_\+\+\_\+uv\+Free\+Crit\+Section (\begin{DoxyParamCaption}\item[{void $\ast$}]{ptr }\end{DoxyParamCaption})}



Thread-\/safe wrapper for {\ttfamily free}. 

This is typically called from the macro expansion of {\ttfamily uv\+Free(x)} 

Definition at line 328 of file uvfr\+\_\+utils.\+c.



References U\+V\+\_\+\+E\+R\+R\+OR, U\+V\+\_\+\+OK, and uv\+Is\+P\+T\+R\+Valid().

\mbox{\Hypertarget{uvfr__utils_8c_a67fb0753300c33287657882ccff64e42}\label{uvfr__utils_8c_a67fb0753300c33287657882ccff64e42}} 
\index{uvfr\_utils.c@{uvfr\_utils.c}!\_\_uvFreeOS@{\_\_uvFreeOS}}
\index{\_\_uvFreeOS@{\_\_uvFreeOS}!uvfr\_utils.c@{uvfr\_utils.c}}
\doxysubsubsection{\texorpdfstring{\_\_uvFreeOS()}{\_\_uvFreeOS()}}
{\footnotesize\ttfamily \mbox{\hyperlink{can_8h_aef3770e45bbacbf527fd93dd80eea9b9}{uv\+\_\+status}} \+\_\+\+\_\+uv\+Free\+OS (\begin{DoxyParamCaption}\item[{void $\ast$}]{ptr }\end{DoxyParamCaption})}



O\+S-\/based free wrapper that calls pv\+Port\+Free. 



Definition at line 379 of file uvfr\+\_\+utils.\+c.



References U\+V\+\_\+\+E\+R\+R\+OR, U\+V\+\_\+\+OK, and uv\+Is\+P\+T\+R\+Valid().

\mbox{\Hypertarget{uvfr__utils_8c_a92b5ac44171d49acd084c274385a043a}\label{uvfr__utils_8c_a92b5ac44171d49acd084c274385a043a}} 
\index{uvfr\_utils.c@{uvfr\_utils.c}!\_\_uvInitPanic@{\_\_uvInitPanic}}
\index{\_\_uvInitPanic@{\_\_uvInitPanic}!uvfr\_utils.c@{uvfr\_utils.c}}
\doxysubsubsection{\texorpdfstring{\_\_uvInitPanic()}{\_\_uvInitPanic()}}
{\footnotesize\ttfamily void \+\_\+\+\_\+uv\+Init\+Panic (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Low Level Panic, that does not require the full U\+V\+FR utils functionality to be operational. 

\begin{DoxyAttention}{Attention}
Calling \+\_\+uv\+Init\+Panic() is irreversable and will cause the vehicle to hang itself. This is only to be used as a last resort to stop the vehicle from entering an invalid state. 
\end{DoxyAttention}


Definition at line 271 of file uvfr\+\_\+utils.\+c.



Referenced by uv\+Init(), uv\+Init\+State\+Engine(), and uv\+S\+V\+C\+Task\+Manager().

\mbox{\Hypertarget{uvfr__utils_8c_abc00b3cb1c3b54fe4490c08ef85a293a}\label{uvfr__utils_8c_abc00b3cb1c3b54fe4490c08ef85a293a}} 
\index{uvfr\_utils.c@{uvfr\_utils.c}!\_\_uvMallocCritSection@{\_\_uvMallocCritSection}}
\index{\_\_uvMallocCritSection@{\_\_uvMallocCritSection}!uvfr\_utils.c@{uvfr\_utils.c}}
\doxysubsubsection{\texorpdfstring{\_\_uvMallocCritSection()}{\_\_uvMallocCritSection()}}
{\footnotesize\ttfamily void$\ast$ \+\_\+\+\_\+uv\+Malloc\+Crit\+Section (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{memrequest }\end{DoxyParamCaption})}



Wrapper function for {\ttfamily malloc()} that makes it thread safe. 

This typically appears in a macro expansion from {\ttfamily uv\+Malloc(x)} 

Definition at line 292 of file uvfr\+\_\+utils.\+c.

\mbox{\Hypertarget{uvfr__utils_8c_a498966c0f95bfa592d26b625a93fa1a3}\label{uvfr__utils_8c_a498966c0f95bfa592d26b625a93fa1a3}} 
\index{uvfr\_utils.c@{uvfr\_utils.c}!\_\_uvMallocOS@{\_\_uvMallocOS}}
\index{\_\_uvMallocOS@{\_\_uvMallocOS}!uvfr\_utils.c@{uvfr\_utils.c}}
\doxysubsubsection{\texorpdfstring{\_\_uvMallocOS()}{\_\_uvMallocOS()}}
{\footnotesize\ttfamily void$\ast$ \+\_\+\+\_\+uv\+Malloc\+OS (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{memrequest }\end{DoxyParamCaption})}



{\ttfamily malloc()} wrapper that calls pv\+Port\+Malloc() rather than malloc() 

The reason we might wanto to be using pv\+Port\+Malloc() rather than regular stdlib malloc() is to consolodate the heap between R\+T\+OS and non-\/\+R\+T\+OS functions. 

Definition at line 353 of file uvfr\+\_\+utils.\+c.



References U\+V\+\_\+\+M\+A\+L\+L\+O\+C\+\_\+\+L\+I\+M\+IT, U\+V\+\_\+\+OK, and uv\+Is\+P\+T\+R\+Valid().

\mbox{\Hypertarget{uvfr__utils_8c_ab80c00a024c34da7f7926212ce10ef01}\label{uvfr__utils_8c_ab80c00a024c34da7f7926212ce10ef01}} 
\index{uvfr\_utils.c@{uvfr\_utils.c}!setup\_extern\_devices@{setup\_extern\_devices}}
\index{setup\_extern\_devices@{setup\_extern\_devices}!uvfr\_utils.c@{uvfr\_utils.c}}
\doxysubsubsection{\texorpdfstring{setup\_extern\_devices()}{setup\_extern\_devices()}}
{\footnotesize\ttfamily void setup\+\_\+extern\+\_\+devices (\begin{DoxyParamCaption}\item[{void $\ast$}]{argument }\end{DoxyParamCaption})}

\begin{DoxyRefDesc}{Deprecated}
\item[\mbox{\hyperlink{deprecated__deprecated000004}{Deprecated}}]I really dunno why this still exists, but this gets called somewhere so Im leaving it. I think we just pass it N\+U\+LL.\end{DoxyRefDesc}


Definition at line 259 of file uvfr\+\_\+utils.\+c.

\mbox{\Hypertarget{uvfr__utils_8c_a6d40598f9d8daa89ca159a2e87f4fd01}\label{uvfr__utils_8c_a6d40598f9d8daa89ca159a2e87f4fd01}} 
\index{uvfr\_utils.c@{uvfr\_utils.c}!uvInit@{uvInit}}
\index{uvInit@{uvInit}!uvfr\_utils.c@{uvfr\_utils.c}}
\doxysubsubsection{\texorpdfstring{uvInit()}{uvInit()}}
{\footnotesize\ttfamily void uv\+Init (\begin{DoxyParamCaption}\item[{void $\ast$}]{arguments }\end{DoxyParamCaption})}



\+: Function that initializes all of the car\textquotesingle{}s stuff. 

This is an R\+T\+OS task, and it serves to setup all of the car\textquotesingle{}s different functions. at this point in our execution, we have already initialized all of our favorite hardware peripherals using H\+AL. Now we get to configure our convoluted system of O\+S-\/level settings and state machines.

It executes the following functions, in order\+:
\begin{DoxyItemize}
\item Load Vehicle Settings
\item Initialize and Start State Machine
\item Start Service Tasks, such as C\+AN, A\+DC, etc...
\item Initialize External Devices such as B\+MS, I\+MD, Motor Controller
\item Validate that these devices have actually booted up
\item Set vehicle state to {\ttfamily U\+V\+\_\+\+R\+E\+A\+DY} 

Pretty important shit if you ask me. 
\end{DoxyItemize}First on the block is our settings. The uv\+\_\+settings are a bit strange, in the following way. We will check if we have saved custom settings, or if these settings are the default or not. It will then perform a checksum on the settings, and validate them to ensure they are safe If it fails to validate the settings, it will attempt to return to factory default.

If it is unable to return even to factory default settings, then we are in H\+U\+GE trouble, and some catastrophic bug has occurred. If it fails to even start this, it will not be safe to drive We must therefore panic.

Next up we will attempt to initialize the state engine. If this fails, then we are in another case where we are genuinely unsafe to drive. This will create the prototypes for a bajillion tasks that will be started and stopped. Which tasks are currently running, depends on the whims of the state engine. Since the state engine is critical to our ability to handle errors and implausibilitys, we cannot proceed without a fully operational state engine.

Once the state machine is initialized we get to actually start the thing.

Once we have initialized the state engine, what we want to do is create the prototypes of all the tasks that will be running.

Now we are going to create a bunch of tasks that will initialize our car\textquotesingle{}s external devices. The reason that these are R\+T\+OS tasks, is that it takes a buncha time to verify the existance of some devices. As a direct result, we can sorta just wait around and check that each task sends a message confirming that it has successfully executed. \+:) However, first we need to actually create a Queue for these tasks to use 
\begin{DoxyCode}{0}
\DoxyCodeLine{  /}
\DoxyCodeLine{QueueHandle\_t init\_validation\_queue = xQueueCreate(8,\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structuv__init__task__response}{uv\_init\_task\_response}}));}
\DoxyCodeLine{\textcolor{keywordflow}{if}(init\_validation\_queue == NULL)\{}
\DoxyCodeLine{    \mbox{\hyperlink{uvfr__utils_8h_a92b5ac44171d49acd084c274385a043a}{\_\_uvInitPanic}}();}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\end{DoxyCode}
 The next big thing on our plate is checking the status of all external devices we need, and initializing them with appropriate parameters. These are split into tasks because it takes a bit of time, especially for devices that need to be configured via C\+A\+N\+Bus such as the motor controller. That is why it is split the way it is, to allow these to run somewhat concurrently 
\begin{DoxyCode}{0}
\DoxyCodeLine{ */}
\DoxyCodeLine{}
\DoxyCodeLine{BaseType\_t retval;}
\DoxyCodeLine{\textcolor{comment}{//osThreadDef\_t MC\_init\_thread = \{"MC\_init",MC\_Startup,osPriorityNormal,128,0\};}}
\DoxyCodeLine{\mbox{\hyperlink{structuv__init__task__args}{uv\_init\_task\_args}}* MC\_init\_args = uvMalloc(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structuv__init__task__args}{uv\_init\_task\_args}}));}
\DoxyCodeLine{MC\_init\_args-\/>\mbox{\hyperlink{structuv__init__task__args_adec47e7a54822cacfb8fcfc35a22157f}{init\_info\_queue}} = init\_validation\_queue;}
\DoxyCodeLine{MC\_init\_args-\/>\mbox{\hyperlink{structuv__init__task__args_a61a9b579a1e65a3875a4edf3201a39f3}{specific\_args}} = \&(\mbox{\hyperlink{uvfr__settings_8h_a03566822d1b8893362970a459bd67daf}{current\_vehicle\_settings}}-\/>\mbox{\hyperlink{structuv__vehicle__settings_ad0b0375d2c1674abc6f972eec47e9cb7}{mc\_settings}});}
\DoxyCodeLine{\textcolor{comment}{//MC\_init\_args-\/>meta\_task\_handle = osThreadCreate(\&MC\_init\_thread,MC\_init\_args);}}
\DoxyCodeLine{\textcolor{comment}{//vTaskResume( MC\_init\_args-\/>meta\_task\_handle );}}
\DoxyCodeLine{retval = xTaskCreate(\mbox{\hyperlink{motor__controller_8h_aed1407e1e0fd59dc7c5e5d6db671f0ab}{MC\_Startup}},\textcolor{stringliteral}{"MC\_init"},128,MC\_init\_args,osPriorityAboveNormal,\&(MC\_init\_args-\/>\mbox{\hyperlink{structuv__init__task__args_a3b81430245e7f832dc1112e53b0ef7ad}{meta\_task\_handle}}));}
\DoxyCodeLine{\textcolor{keywordflow}{if}(retval != pdPASS)\{}
\DoxyCodeLine{    \textcolor{comment}{//FUCK}}
\DoxyCodeLine{    error\_msg = \textcolor{stringliteral}{"bruh"};}
\DoxyCodeLine{\}}
\end{DoxyCode}
 This thread is for initializing the B\+MS 
\begin{DoxyCode}{0}
\DoxyCodeLine{ */}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//osThreadDef\_t BMS\_init\_thread = \{"BMS\_init",BMS\_Init,osPriorityNormal,128,0\};}}
\DoxyCodeLine{\mbox{\hyperlink{structuv__init__task__args}{uv\_init\_task\_args}}* BMS\_init\_args = uvMalloc(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structuv__init__task__args}{uv\_init\_task\_args}}));}
\DoxyCodeLine{BMS\_init\_args-\/>\mbox{\hyperlink{structuv__init__task__args_adec47e7a54822cacfb8fcfc35a22157f}{init\_info\_queue}} = init\_validation\_queue;}
\DoxyCodeLine{BMS\_init\_args-\/>\mbox{\hyperlink{structuv__init__task__args_a61a9b579a1e65a3875a4edf3201a39f3}{specific\_args}} = \&(\mbox{\hyperlink{uvfr__settings_8h_a03566822d1b8893362970a459bd67daf}{current\_vehicle\_settings}}-\/>\mbox{\hyperlink{structuv__vehicle__settings_a6cdca5b5474080f1dff4d19ef96435e1}{bms\_settings}});}
\DoxyCodeLine{\textcolor{comment}{//BMS\_init\_args-\/>meta\_task\_handle = osThreadCreate(\&BMS\_init\_thread,BMS\_init\_args);}}
\DoxyCodeLine{retval = xTaskCreate(\mbox{\hyperlink{bms_8h_aa9af83736568f74c94d41f3f16adf513}{BMS\_Init}},\textcolor{stringliteral}{"BMS\_init"},128,BMS\_init\_args,osPriorityAboveNormal,\&(BMS\_init\_args-\/>\mbox{\hyperlink{structuv__init__task__args_a3b81430245e7f832dc1112e53b0ef7ad}{meta\_task\_handle}}));}
\DoxyCodeLine{\textcolor{keywordflow}{if}(retval != pdPASS)\{}
\DoxyCodeLine{    \textcolor{comment}{//FUCK}}
\DoxyCodeLine{    error\_msg = \textcolor{stringliteral}{"bruh"};}
\DoxyCodeLine{\}}
\end{DoxyCode}
 This variable is a tracker that tracks which devices have successfully initialized 
\begin{DoxyCode}{0}
\DoxyCodeLine{ */}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{structuv__init__task__args}{uv\_init\_task\_args}}* IMD\_init\_args = uvMalloc(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structuv__init__task__args}{uv\_init\_task\_args}}));}
\DoxyCodeLine{IMD\_init\_args-\/>\mbox{\hyperlink{structuv__init__task__args_adec47e7a54822cacfb8fcfc35a22157f}{init\_info\_queue}} = init\_validation\_queue;}
\DoxyCodeLine{IMD\_init\_args-\/>\mbox{\hyperlink{structuv__init__task__args_a61a9b579a1e65a3875a4edf3201a39f3}{specific\_args}} = \&(\mbox{\hyperlink{uvfr__settings_8h_a03566822d1b8893362970a459bd67daf}{current\_vehicle\_settings}}-\/>\mbox{\hyperlink{structuv__vehicle__settings_a5b56318f394bef60ff7da0b4995183e0}{imd\_settings}});}
\DoxyCodeLine{retval = xTaskCreate(\mbox{\hyperlink{imd_8h_a19b4fd879f065cfe6e1b7bb3400cd0c3}{initIMD}},\textcolor{stringliteral}{"BMS\_init"},128,IMD\_init\_args,osPriorityAboveNormal,\&(IMD\_init\_args-\/>\mbox{\hyperlink{structuv__init__task__args_a3b81430245e7f832dc1112e53b0ef7ad}{meta\_task\_handle}}));}
\DoxyCodeLine{\textcolor{keywordflow}{if}(retval != pdPASS)\{}
\DoxyCodeLine{        \textcolor{comment}{//FUCK}}
\DoxyCodeLine{    error\_msg = \textcolor{stringliteral}{"bruh"};}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{structuv__init__task__args}{uv\_init\_task\_args}}* PDU\_init\_args = uvMalloc(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structuv__init__task__args}{uv\_init\_task\_args}}));}
\DoxyCodeLine{PDU\_init\_args-\/>\mbox{\hyperlink{structuv__init__task__args_adec47e7a54822cacfb8fcfc35a22157f}{init\_info\_queue}} = init\_validation\_queue;}
\DoxyCodeLine{PDU\_init\_args-\/>\mbox{\hyperlink{structuv__init__task__args_a61a9b579a1e65a3875a4edf3201a39f3}{specific\_args}} = \&(\mbox{\hyperlink{uvfr__settings_8h_a03566822d1b8893362970a459bd67daf}{current\_vehicle\_settings}}-\/>\mbox{\hyperlink{structuv__vehicle__settings_a5b56318f394bef60ff7da0b4995183e0}{imd\_settings}});}
\DoxyCodeLine{retval = xTaskCreate(\mbox{\hyperlink{pdu_8h_afaa6671d51bcd0687c87ac635ff70d95}{initPDU}},\textcolor{stringliteral}{"PDU\_init"},128,PDU\_init\_args,osPriorityAboveNormal,\&(PDU\_init\_args-\/>\mbox{\hyperlink{structuv__init__task__args_a3b81430245e7f832dc1112e53b0ef7ad}{meta\_task\_handle}})); \textcolor{comment}{//pass in the right settings, dumdum}}
\DoxyCodeLine{\textcolor{keywordflow}{if}(retval != pdPASS)\{}
\DoxyCodeLine{        \textcolor{comment}{//FUCK}}
\DoxyCodeLine{    error\_msg = \textcolor{stringliteral}{"bruh"};}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{uint16\_t ext\_devices\_status = 0x000F; \textcolor{comment}{//Tracks which devices are currently setup}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\end{DoxyCode}


Wait for all the spawned in tasks to do their thing. This should not take that long, but we wanna be sure that everything is chill If we are say, missing a B\+MS, then it will not allow you to proceed past the initialisation step This is handled by a message buffer, that takes inputs from all of the tasks

We allocate space for a response from the initialization.

Clean up, clean up, everybody clean up, clean up, clean up, everybody do your share! The following code cleans up all the threads that were running, and free up used memory

Definition at line 39 of file uvfr\+\_\+utils.\+c.



References \+\_\+\+\_\+uv\+Init\+Panic(), B\+M\+S\+\_\+\+Init(), uv\+\_\+vehicle\+\_\+settings\+::bms\+\_\+settings, change\+Vehicle\+State(), current\+\_\+vehicle\+\_\+settings, uv\+\_\+init\+\_\+task\+\_\+response\+::device, uv\+\_\+init\+\_\+task\+\_\+response\+::errmsg, uv\+\_\+vehicle\+\_\+settings\+::imd\+\_\+settings, I\+N\+I\+T\+\_\+\+C\+H\+E\+C\+K\+\_\+\+P\+E\+R\+I\+OD, uv\+\_\+init\+\_\+task\+\_\+args\+::init\+\_\+info\+\_\+queue, init\+\_\+task\+\_\+handle, init\+I\+M\+D(), init\+P\+D\+U(), M\+A\+X\+\_\+\+I\+N\+I\+T\+\_\+\+T\+I\+ME, uv\+\_\+vehicle\+\_\+settings\+::mc\+\_\+settings, M\+C\+\_\+\+Startup(), uv\+\_\+init\+\_\+task\+\_\+args\+::meta\+\_\+task\+\_\+handle, uv\+\_\+init\+\_\+task\+\_\+response\+::nchar, uv\+\_\+init\+\_\+task\+\_\+args\+::specific\+\_\+args, uv\+\_\+init\+\_\+task\+\_\+response\+::status, U\+V\+\_\+\+OK, U\+V\+\_\+\+R\+E\+A\+DY, uv\+Init\+State\+Engine(), uv\+Settings\+Init(), and uv\+Start\+State\+Machine().



Referenced by M\+X\+\_\+\+F\+R\+E\+E\+R\+T\+O\+S\+\_\+\+Init().

\mbox{\Hypertarget{uvfr__utils_8c_a0186c036688c7852cf0ceaee96b343a3}\label{uvfr__utils_8c_a0186c036688c7852cf0ceaee96b343a3}} 
\index{uvfr\_utils.c@{uvfr\_utils.c}!uvIsPTRValid@{uvIsPTRValid}}
\index{uvIsPTRValid@{uvIsPTRValid}!uvfr\_utils.c@{uvfr\_utils.c}}
\doxysubsubsection{\texorpdfstring{uvIsPTRValid()}{uvIsPTRValid()}}
{\footnotesize\ttfamily \mbox{\hyperlink{can_8h_aef3770e45bbacbf527fd93dd80eea9b9}{uv\+\_\+status}} uv\+Is\+P\+T\+R\+Valid (\begin{DoxyParamCaption}\item[{void $\ast$}]{ptr }\end{DoxyParamCaption})}



function that checks to make sure a pointer points to a place it is allowed to point to 

The primary motivation for this is to avoid trying to dereference a pointer that doesnt exist, and triggering the {\ttfamily Hard\+Fault\+Handler()}. That is never a fun time. This allows us to exit gracefully instead of getting stuck in an I\+RQ handler

Exiting gracefully can be pretty neat sometimes. 

Definition at line 401 of file uvfr\+\_\+utils.\+c.



References U\+V\+\_\+\+E\+R\+R\+OR, U\+V\+\_\+\+OK, and U\+V\+\_\+\+W\+A\+R\+N\+I\+NG.



Referenced by \+\_\+\+\_\+uv\+Free\+Crit\+Section(), \+\_\+\+\_\+uv\+Free\+O\+S(), and \+\_\+\+\_\+uv\+Malloc\+O\+S().

\mbox{\Hypertarget{uvfr__utils_8c_a11806db468fdae50664b98e619575425}\label{uvfr__utils_8c_a11806db468fdae50664b98e619575425}} 
\index{uvfr\_utils.c@{uvfr\_utils.c}!uvSysResetDaemon@{uvSysResetDaemon}}
\index{uvSysResetDaemon@{uvSysResetDaemon}!uvfr\_utils.c@{uvfr\_utils.c}}
\doxysubsubsection{\texorpdfstring{uvSysResetDaemon()}{uvSysResetDaemon()}}
{\footnotesize\ttfamily void uv\+Sys\+Reset\+Daemon (\begin{DoxyParamCaption}\item[{void $\ast$}]{args }\end{DoxyParamCaption})}



Definition at line 233 of file uvfr\+\_\+utils.\+c.



Referenced by uv\+Utils\+Reset().

\mbox{\Hypertarget{uvfr__utils_8c_a02781145b4802ebdc7001800bbe6d994}\label{uvfr__utils_8c_a02781145b4802ebdc7001800bbe6d994}} 
\index{uvfr\_utils.c@{uvfr\_utils.c}!uvUtilsReset@{uvUtilsReset}}
\index{uvUtilsReset@{uvUtilsReset}!uvfr\_utils.c@{uvfr\_utils.c}}
\doxysubsubsection{\texorpdfstring{uvUtilsReset()}{uvUtilsReset()}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{uvfr__utils_8h_a71c52c44be11d0980910401cb9b5fb9e}{uv\+\_\+status\+\_\+t}} uv\+Utils\+Reset (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



This function is a soft-\/reboot of the uv\+\_\+utils\+\_\+backend and OS abstraction. 

The idea here is to basically start from a blank slate and boot up everything. So therefore we must\+:
\begin{DoxyItemize}
\item Halt state machine.
\item Nuke vehicle operation related tasks.
\item Nuke the state machine
\item Nuke old settings
\end{DoxyItemize}

reinitialize uv\+\_\+utils 

Definition at line 250 of file uvfr\+\_\+utils.\+c.



References reset\+\_\+handle, U\+V\+\_\+\+OK, and uv\+Sys\+Reset\+Daemon().



\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{uvfr__utils_8c_a142da7a698285a444ffffb0d1d791023}\label{uvfr__utils_8c_a142da7a698285a444ffffb0d1d791023}} 
\index{uvfr\_utils.c@{uvfr\_utils.c}!init\_task\_handle@{init\_task\_handle}}
\index{init\_task\_handle@{init\_task\_handle}!uvfr\_utils.c@{uvfr\_utils.c}}
\doxysubsubsection{\texorpdfstring{init\_task\_handle}{init\_task\_handle}}
{\footnotesize\ttfamily Task\+Handle\+\_\+t init\+\_\+task\+\_\+handle}



Definition at line 51 of file freertos.\+c.



Referenced by M\+X\+\_\+\+F\+R\+E\+E\+R\+T\+O\+S\+\_\+\+Init(), and uv\+Init().

\mbox{\Hypertarget{uvfr__utils_8c_a4e2f70766df64229ab99dfe80c0c012a}\label{uvfr__utils_8c_a4e2f70766df64229ab99dfe80c0c012a}} 
\index{uvfr\_utils.c@{uvfr\_utils.c}!reset\_handle@{reset\_handle}}
\index{reset\_handle@{reset\_handle}!uvfr\_utils.c@{uvfr\_utils.c}}
\doxysubsubsection{\texorpdfstring{reset\_handle}{reset\_handle}}
{\footnotesize\ttfamily Task\+Handle\+\_\+t reset\+\_\+handle = N\+U\+LL}



Definition at line 15 of file uvfr\+\_\+utils.\+c.



Referenced by uv\+Utils\+Reset().

\mbox{\Hypertarget{uvfr__utils_8c_af553c31425b32bd9c020380c942ed3bd}\label{uvfr__utils_8c_af553c31425b32bd9c020380c942ed3bd}} 
\index{uvfr\_utils.c@{uvfr\_utils.c}!TxData@{TxData}}
\index{TxData@{TxData}!uvfr\_utils.c@{uvfr\_utils.c}}
\doxysubsubsection{\texorpdfstring{TxData}{TxData}}
{\footnotesize\ttfamily uint8\+\_\+t Tx\+Data\mbox{[}8\mbox{]}}



Definition at line 7 of file constants.\+c.

